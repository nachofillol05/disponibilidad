<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reserva | Arraial para Argentinos</title>
  <link rel="icon" type="image/jpeg" href="/arraialLogo.jpeg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f1f5f9;
      --card: #ffffff;
      --available: #22c55e;
      --selected: #0284c7;
      --unavailable: #e2e8f0;
      --text: #1e293b;
      --muted: #64748b;
    }

    * { box-sizing: border-box; font-family: 'Outfit', sans-serif; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      padding: 15px;
      min-height: 100vh;
      padding-bottom: 110px;
      -webkit-font-smoothing: antialiased;
    }

    .container { max-width: 420px; margin: 0 auto; }

    header { text-align: center; margin-bottom: 15px; }
    h1 { font-size: 1.8rem; margin: 0; font-weight: 900; text-transform: uppercase; color: #0f172a; }

    .month-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      background: white;
      padding: 8px 12px;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    }

    .month-nav h2 { margin: 0; font-size: 1rem; text-transform: capitalize; font-weight: 700; color: var(--selected); }

    .nav-btn {
      background: #f1f5f9;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .nav-btn:hover { background: var(--selected); color: white; }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-size: 0.65rem;
      color: var(--muted);
      margin-bottom: 8px;
      font-weight: 800;
    }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }

    .day {
      aspect-ratio: 1.1 / 1;
      background: white;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #e2e8f0;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .day.empty { background: transparent; border: none; cursor: default; }

    .day.available:hover { transform: scale(1.05); border-color: var(--selected); color: var(--selected); }

    .day.selected {
      background: var(--selected) !important;
      color: white;
      border-color: var(--selected);
      box-shadow: 0 4px 10px rgba(2, 132, 199, 0.3);
    }

    .day.unavailable { background: #f8fafc; color: #cbd5e1; text-decoration: line-through; border: 1px solid #f1f5f9; cursor: not-allowed; }

    .legend { display: flex; justify-content: center; gap: 12px; margin-top: 15px; font-size: 0.7rem; color: var(--muted); font-weight: 600; }
    .dot { width: 8px; height: 8px; border-radius: 2px; display: inline-block; margin-right: 3px; }

    .reviews-slider {
      margin-top: 25px;
      background: white;
      border-radius: 20px;
      padding: 15px;
      border: 1px solid #e2e8f0;
      text-align: center;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    }
    .reviews-slider h2 { font-weight: 900; text-transform: uppercase; color: #0f172a; margin-bottom: 12px; font-size: 1rem; }
    .slider-wrapper { display: flex; align-items: center; gap: 10px; }
    .review-slide { flex: 1; background: #f8fafc; padding: 12px; border-radius: 12px; min-height: 110px; border: 1px solid #f1f5f9; }
    .slide-btn { background: #f1f5f9; border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; }

    .review-name { font-weight: 800; font-size: 0.85rem; }
    .review-stars { color: #f59e0b; font-size: 0.75rem; margin: 2px 0; }
    .review-text { font-size: 0.75rem; line-height: 1.4; color: #475569; }

    .action-bar {
      position: fixed;
      bottom: -100px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      background: #ffffff;
      padding: 12px 18px;
      border-radius: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 1000;
      border: 1px solid #e2e8f0;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .action-bar.visible { bottom: 20px; }
    .btn-wpp { background: #22c55e; color: white; text-decoration: none; padding: 10px 20px; border-radius: 14px; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; }
    .count-text { font-weight: 900; font-size: 1.1rem; color: var(--selected); }
    .sub-text { font-size: 0.65rem; color: var(--muted); font-weight: 700; margin-top: -2px; }
  </style>
</head>
<body>

<div class="container">
  <header><h1>Disponibilidad</h1></header>

  <div class="month-nav">
    <button class="nav-btn" onclick="changeMonth(-1)">❮</button>
    <h2 id="monthTitle"></h2>
    <button class="nav-btn" onclick="changeMonth(1)">❯</button>
  </div>

  <div class="weekdays">
    <div>LUN</div><div>MAR</div><div>MIE</div><div>JUE</div><div>VIE</div><div>SAB</div><div>DOM</div>
  </div>

  <div id="calendarGrid" class="calendar-grid"></div>

  <div class="legend">
    <span><span class="dot" style="background: white; border:1px solid #ddd"></span>Libre</span>
    <span><span class="dot" style="background: #cbd5e1"></span>Ocupado</span>
    <span><span class="dot" style="background: var(--selected)"></span>Tu selección</span>
  </div>

  <section class="reviews-slider">
    <h2>⭐ Opiniones</h2>
    <div class="slider-wrapper">
      <button class="slide-btn" onclick="prevReview()">❮</button>
      <div id="reviewBox" class="review-slide"></div>
      <button class="slide-btn" onclick="nextReview()">❯</button>
    </div>
  </section>
</div>

<div id="actionBar" class="action-bar">
  <div>
    <div id="countLabel" class="count-text">0 días</div>
    <div class="sub-text">FECHAS ELEGIDAS</div>
  </div>
  <a id="wppLink" href="#" target="_blank" class="btn-wpp">Consultar</a>
</div>

<script>
  // Seteamos la fecha al primer día del mes actual para evitar errores de navegación
  let currentMonth = new Date();
  currentMonth.setDate(1); 
  
  let selectedDates = [];
  let unavailableDates = []; 
  const MI_TELEFONO = "543515472701";

  const today = new Date();
  today.setHours(0, 0, 0, 0);

  async function loadData() {
    try {
      const res = await fetch("/availability.json?v=" + Date.now());
      unavailableDates = await res.json();
    } catch (e) { console.warn("Error JSON"); }
    renderCalendar();
  }

  function renderCalendar() {
    const grid = document.getElementById("calendarGrid");
    const monthTitle = document.getElementById("monthTitle");
    grid.innerHTML = "";

    const year = currentMonth.getFullYear();
    const month = currentMonth.getMonth();

    monthTitle.innerText = new Intl.DateTimeFormat('es-ES', { month: 'long', year: 'numeric' }).format(currentMonth);

    // Corregimos el cálculo del primer día (Lunes = 0)
    let firstDay = new Date(year, month, 1).getDay();
    let startingIndex = firstDay === 0 ? 6 : firstDay - 1;

    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < startingIndex; i++) {
      grid.appendChild(Object.assign(document.createElement("div"), {className: "day empty"}));
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const dateObj = new Date(year, month, day);
      const iso = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      
      const card = document.createElement("div");
      card.className = "day";
      card.innerText = day;

      if (dateObj < today || unavailableDates.includes(iso)) {
        card.classList.add("unavailable");
      } else {
        card.classList.add("available");
        if (selectedDates.includes(iso)) card.classList.add("selected");
        card.onclick = () => toggleDate(iso);
      }
      grid.appendChild(card);
    }
  }

  function toggleDate(iso) {
    selectedDates.includes(iso) ? selectedDates = selectedDates.filter(d => d !== iso) : selectedDates.push(iso);
    renderCalendar();
    updateBar();
  }

  function updateBar() {
    const bar = document.getElementById("actionBar");
    if (selectedDates.length > 0) {
      bar.classList.add("visible");
      document.getElementById("countLabel").innerText = `${selectedDates.length} ${selectedDates.length === 1 ? 'día' : 'días'}`;
      const fechasLindas = selectedDates.sort().map(f => f.split("-").reverse().slice(0,2).join("/"));
      document.getElementById("wppLink").href = `https://wa.me/${MI_TELEFONO}?text=${encodeURIComponent('¡Hola! Estoy interesado en alquilar el depto para estos días: ' + fechasLindas.join(", "))}`;
    } else { bar.classList.remove("visible"); }
  }

  function changeMonth(diff) {
    currentMonth.setMonth(currentMonth.getMonth() + diff);
    renderCalendar();
  }

  // LÓGICA DE REVIEWS
  let reviews = [];
  let currentReview = 0;
  async function loadReviews() {
    try {
      const res = await fetch("/reviews.json?v=" + Date.now());
      reviews = await res.json();
      renderReview();
    } catch { console.warn("Error Reviews"); }
  }

  function renderReview() {
    if (!reviews.length) return;
    const r = reviews[currentReview];
    document.getElementById("reviewBox").innerHTML = `
      <div class="review-name">${r.name}</div>
      <div class="review-stars">${"★".repeat(r.stars)}</div>
      <div class="review-text">${r.text}</div>
    `;
  }

  function nextReview() { currentReview = (currentReview + 1) % reviews.length; renderReview(); }
  function prevReview() { currentReview = (currentReview - 1 + reviews.length) % reviews.length; renderReview(); }

  loadData();
  loadReviews();
  setInterval(nextReview, 4500);
</script>
</body>
</html>